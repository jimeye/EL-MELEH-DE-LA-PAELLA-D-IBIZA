MAINTENANCE DES BASES DE DONN√âES (UPSTASH + SUPABASE)
========================================================

Ce guide vous explique comment maintenir vos bases de donn√©es actives pour √©viter qu'elles soient supprim√©es.

PROBL√àME
--------
Upstash ET Supabase suppriment les bases de donn√©es gratuites inactives. Pour √©viter cela, nous devons g√©n√©rer du trafic r√©gulier.

SOLUTIONS
---------

Option 1: Script combin√© (RECOMMAND√â)
-------------------------------------
# D√©marrer la maintenance de toutes les bases de donn√©es
./start_database_maintenance.sh

# Ou avec un intervalle personnalis√© (ex: 4 heures)
./start_database_maintenance.sh 4

Option 2: Scripts individuels
-----------------------------
# Maintenance Upstash uniquement
./start_upstash_maintenance.sh

# Maintenance Supabase uniquement
node utils/keep_supabase_alive.js --continuous

# Maintenance combin√©e manuelle
node utils/keep_all_databases_alive.js --continuous

Option 3: Scripts manuels
-------------------------
# Test unique combin√©
node utils/keep_all_databases_alive.js

# Mode continu (6 heures par d√©faut)
node utils/keep_all_databases_alive.js --continuous

# Mode continu avec intervalle personnalis√© (1 heure)
node utils/keep_all_databases_alive.js --continuous --interval=3600000

PR√âREQUIS
---------
1. Serveur Next.js en cours d'ex√©cution
   npm run dev

2. Variables d'environnement (optionnel)
   Ajoutez dans .env.local :
   UPSTASH_REDIS_REST_URL=votre_url_upstash
   UPSTASH_REDIS_REST_TOKEN=votre_token_upstash
   NEXT_PUBLIC_SUPABASE_URL=votre_url_supabase
   NEXT_PUBLIC_SUPABASE_ANON_KEY=votre_cle_supabase

FONCTIONNEMENT
--------------

Upstash Redis:
Le script g√©n√®re du trafic en appelant les API :
- /api/check-counter
- /api/generate-order-number
- /api/get-commandes
- /api/admin-commandes

Supabase:
Le script g√©n√®re du trafic en visitant les pages :
- /admin (authentification)
- /admin/plats (base de donn√©es)
- /admin/images (stockage)
- /api/instagram-simple (API)

Ces appels maintiennent vos bases de donn√©es actives.

INTERVALLES RECOMMAND√âS
-----------------------
- 6 heures : Par d√©faut, suffisant pour maintenir l'activit√©
- 4 heures : Plus fr√©quent, pour plus de s√©curit√©
- 1 heure : Tr√®s fr√©quent, si vous voulez √™tre s√ªr

D√âMARRAGE AUTOMATIQUE
---------------------
Pour d√©marrer automatiquement la maintenance :

# Dans un nouveau terminal
./start_database_maintenance.sh

# Ou avec intervalle personnalis√©
./start_database_maintenance.sh 4

ARR√äT
-----
Appuyez sur Ctrl+C pour arr√™ter le script.

MONITORING
----------
Le script affiche :
- ‚úÖ Statut de chaque API/page
- ‚è∞ Prochaine g√©n√©ration de trafic
- üïê Timestamp de chaque action
- üìä Trafic Upstash et Supabase s√©par√©

V√âRIFICATION
-----------
Pour v√©rifier que √ßa fonctionne :
1. Lancez le script
2. V√©rifiez les logs Upstash et Supabase dans vos dashboards
3. Vous devriez voir de l'activit√© r√©guli√®re

CONSEILS
--------
- Gardez le script en cours d'ex√©cution sur votre serveur
- Utilisez un intervalle de 4-6 heures pour √©conomiser les ressources
- Surveillez les logs pour d√©tecter les erreurs
- Red√©marrez le script si n√©cessaire

D√âPANNAGE
---------

Erreur "Serveur Next.js non accessible"
npm run dev

Erreur "Variables d'environnement manquantes"
Ajoutez les variables dans .env.local

Script qui s'arr√™te
Red√©marrez avec : ./start_database_maintenance.sh

EMAILS DE SUPPRESSION
--------------------
Upstash : "Inactive database notice"
Supabase : "Database inactivity warning"

Solution : Lancez imm√©diatement le script de maintenance !

R√âSULTAT
--------
Vos bases de donn√©es Upstash ET Supabase resteront actives et vous ne recevrez plus d'emails de suppression !

COMMANDES RAPIDES
=================

# D√©marrer maintenance combin√©e
./start_database_maintenance.sh

# Test unique
node utils/keep_all_databases_alive.js

# Mode continu 4 heures
./start_database_maintenance.sh 4

# Arr√™ter script
Ctrl+C

# V√©rifier serveur
curl http://localhost:3002 